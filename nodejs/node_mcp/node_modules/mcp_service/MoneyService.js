var config = require("mcp_config");
var ac = config.ac;

var esut = require("easy_util");
var log = esut.log;

var customerSer = require("./CustomerService.js");

var MoneyService = function(){};


MoneyService.prototype.handle = function(customerId, orderId, roleCode, accountCode, typeCode, subjectCode, amount, options, cb)
{
    var self = this;
    if(amount <= 0)
    {
        cb(null, null);
        return;
    }
    var detailSubjectId = ac[roleCode][accountCode][typeCode][subjectCode].id;
    var roleId = detailSubjectId.substr(0, 2);
    var accountId = detailSubjectId.substr(2, 2);
    var typeId = detailSubjectId.substr(4, 1);
    var subjectId = detailSubjectId.substr(5, 4);
    if(typeCode == "out")
    {
        amount = amount*(-1);
    }
    customerSer.balanceChange({id:customerId}, orderId, roleId, accountId, typeId,
        subjectId, amount, options, cb);
}

MoneyService.prototype.handleById = function(customerId, orderId, roleId, accountId, typeId, subjectId, amount, options, cb)
{
    var self = this;
    if(amount <= 0)
    {
        cb(null, null);
        return;
    }
    var typeCode = ac.getInfo(roleId, accountId, typeId).code;
    if(typeCode == "out")
    {
        amount = amount*(-1);
    }
    customerSer.balanceChange({id:customerId}, orderId, roleId, accountId, typeId,
        subjectId, amount, options, cb);
}

module.exports = new MoneyService();